name: RoboDerik V55 Trader (Real)

on:
  # 1. Agendamento padr茫o (backup caso o Google falhe)
  schedule:
    - cron: '*/5 * * * *'
  
  # 2. Gatilho Manual (Bot茫o Run Workflow)
  workflow_dispatch:
  
  # 3. GATILHO EXTERNO (Mantido para seu App Script) 
  repository_dispatch:
    types: [forcar_execucao]

permissions:
  contents: write

jobs:
  trade:
    runs-on: ubuntu-latest
    
    steps:
      - name: Baixar c贸digo do reposit贸rio
        uses: actions/checkout@v3

      - name: Configurar Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.12'

      - name: Instalar bibliotecas
        run: |
          # Adicionei 'ccxt' que 茅 vital para conectar na Binance
          pip install ccxt pandas pandas_ta numpy pytz requests

      - name: Rodar Rob么 Real (V55)
        env:
          # ATENO: Configure estas chaves nos Secrets do GitHub!
          BINANCE_API_KEY: ${{ secrets.BINANCE_API_KEY }}
          BINANCE_SECRET_KEY: ${{ secrets.BINANCE_SECRET_KEY }}
        run: python bot.py

      - name: Salvar Mem贸ria do Rob么 (Commit)
        run: |
          git config --global user.name 'RoboDerik Bot'
          git config --global user.email 'bot@djmtecnologia.com'
          
          # O V55 salva tudo no estado.json (Martingale, Quarentena, Banca)
          # Se n茫o salvar isso, ele reseta e perde dinheiro!
          git add estado.json
          
          # Comando seguro: s贸 faz commit se houver mudan莽a no arquivo
          git diff --quiet && git diff --staged --quiet || (git commit -m " Atualizando Estado do Martingale [skip ci]" && git push)
